define("conditioner/Observer",[],function(){var t=1,e={};return{_setEntry:function(n,i){var o=n.__pubSubUID;return o||(o=t++,n.__pubSubUID=o,e[o]={obj:n}),e[o][i]||(e[o][i]=[]),e[o]},_getEntryProp:function(t,n){var i=e[t.__pubSubUID];return i?e[t.__pubSubUID][n]:null},subscribe:function(t,e,n){for(var i,o=this._setEntry(t,"subscriptions"),r=0,s=o.subscriptions,u=s.length;u>r;r++)if(i=s[r],i.type===e&&i.fn===n)return;s.push({type:e,fn:n})},unsubscribe:function(t,e,n){var i=this._getEntryProp(t,"subscriptions");if(i)for(var o,r=i.length;--r>=0;)o=i[r],o.type!==e||o.fn!==n&&n||i.splice(r,1)},publishAsync:function(t,e,n){var i=this;setTimeout(function(){i.publish(t,e,n)},0)},publish:function(t,e,n){for(var i,o=this._setEntry(t,"subscriptions"),r=[],s=0,u=o.subscriptions,a=u.length,l=o.receivers;a>s;s++)i=u[s],i.type===e&&r.push(i);for(a=r.length,s=0;a>s;s++)r[s].fn(n);if(l)for(a=l.length,s=0;a>s;s++)this.publish(l[s],e,n)},inform:function(t,e){if(!t||!e)return!1;var n=this._setEntry(t,"receivers");return n.receivers.push(e),!0},conceal:function(t,e){if(!t||!e)return!1;var n=this._getEntryProp(t,"receivers");if(!n)return!1;for(var i,o=n.length;--o>=0;)if(i=n[o],i===e)return n.splice(o,1),!0;return!1}}}),define("conditioner/contains",[],function(){var t=document?document.body:null;return t&&t.compareDocumentPosition?function(t,e){return!!(16&t.compareDocumentPosition(e))}:t&&t.contains?function(t,e){return t!=e&&t.contains(e)}:function(t,e){for(var n=e.parentNode;n;){if(n===t)return!0;n=n.parentNode}return!1}}),define("conditioner/matchesSelector",[],function(){var t=null,e=document?document.body:null;return!e||e.matches?t="matches":e.webkitMatchesSelector?t="webkitMatchesSelector":e.mozMatchesSelector?t="mozMatchesSelector":e.msMatchesSelector?t="msMatchesSelector":e.oMatchesSelector&&(t="oMatchesSelector"),t?function(e,n){return e[t](n)}:function(t,e){for(var n=(t.parentNode||document).querySelectorAll(e)||[],i=n.length;i--;)if(n[i]==t)return!0;return!1}}),define("conditioner/mergeObjects",[],function(){var t=function(e,n){var i=Array.isArray(n),o=i&&[]||{};return n=n||{},i?(e=e||[],o=o.concat(e),n.forEach(function(n,i){"object"==typeof n?o[i]=t(e[i],n):-1===e.indexOf(n)&&o.push(n)})):(e&&"object"==typeof e&&Object.keys(e).forEach(function(t){o[t]=e[t]}),Object.keys(n).forEach(function(i){o[i]="object"==typeof n[i]&&n[i]?e[i]?t(e[i],n[i]):n[i]:n[i]})),o};return t}),define(["require","conditioner/Observer","conditioner/contains","conditioner/matchesSelector","conditioner/mergeObjects"],function(t,e,n,i,o){var r=function(){};r.prototype={succeeds:function(){},getConfig:function(){}};var s=function(t,e){this._expression=t instanceof u||t instanceof s?t:null,this._config=this._expression?null:t,this._negate=void 0===e?!1:e};s.prototype=Object.create(r),s.prototype.assignTester=function(t){this._expression=t},s.prototype.getConfig=function(){return this._config?[{expression:this,config:this._config}]:this._expression.getConfig()},s.prototype.succeeds=function(){return this._expression.succeeds?this._expression.succeeds()!==this._negate:!1},s.prototype.toString=function(){return(this._negate?"not ":"")+(this._expression?""+this._expression:this._config.path+":{"+this._config.value+"}")};var u=function(t,e,n){this._a=t,this._operator=e,this._b=n};u.prototype=Object.create(r),u.prototype.succeeds=function(){return"and"===this._operator?this._a.succeeds()&&this._b.succeeds():this._a.succeeds()||this._b.succeeds()},u.prototype.toString=function(){return"("+(""+this._a)+" "+this._operator+" "+(""+this._b)+")"},u.prototype.getConfig=function(){return[this._a.getConfig(),this._b.getConfig()]};var a={getExpressionsCount:function(t){return t.match(/(:\{)/g).length},fromString:function(t){var e,n,i,o,r,a,l,h,c,d,p=0,f="",_=[],g="",m=!1,v=!1,b=null,y=null,M=[],C=t.length;for(b||(b=_);C>p;p++)if(r=t.charCodeAt(p),123!==r)if(125===r&&(e=b.length-1,n=e+1,m="not"===b[e],n=m?e:e+1,b[n]=new s({path:f,value:g},m),f="",g="",m=!1,v=!1),v)g+=t.charAt(p);else{if(40===r&&(b.push([]),M.push(b),b=b[b.length-1]),32===r||0===p||40===r){if(i=t.substr(p,5).match(/and |or |not /g),!i)continue;h=i[0],c=h.length-1,b.push(h.substring(0,c)),p+=c}if(41===r||p===C-1)do if(y=M.pop(),0!==b.length){for(o=0,d=b.length;d>o;o++)"string"==typeof b[o]&&("not"===b[o]?(b.splice(o,2,new s(b[o+1],!0)),o=-1,d=b.length):"not"!==b[o+1]&&(b.splice(o-1,3,new u(b[o-1],b[o],b[o+1])),o=-1,d=b.length));1===b.length&&y&&(y[y.length-1]=b[0],b=y)}else b=y;while(p===C-1&&y)}else for(v=!0,f="",a=p-2;a>=0&&(l=t.charCodeAt(a),32!==l&&40!==l);)f=t.charAt(a)+f,a--;return 1===_.length?_[0]:_}},l={_tests:{},_createTest:function(t,n){if(!n.assert)throw Error('TestRegister._addTest(path,config): "config.assert" is a required parameter.');var i=function(){};return i.supported="support"in n?n.support():!0,i._callbacks=[],i._ready=!1,i._setup=function(t){i.supported&&(i._callbacks.push(t.onchange.bind(t)),i._ready||(i._ready=!0,n.setup.call(i,i._measure)))},i._measure=function(t){var e="measure"in n?n.measure.call(i._measure,t):!0;if(e)for(var o=0,r=i._callbacks.length;r>o;o++)i._callbacks[o](t)},i.prototype.supported=function(){return i.supported},i.prototype.onchange=function(){e.publish(this,"change")},i.prototype.arrange=n.arrange?function(t,e){i.supported&&n.arrange.call(this,t,e)}:function(){i._setup(this)},n.measure&&(i.prototype.measure=n.measure),i.prototype.assert=n.assert,i},_findTest:function(t){return this._tests[t]},_storeTest:function(t,e){this._tests[t]=e},getTest:function(e,n){e="conditioner/tests/"+e,t([e],function(t){var i=l._findTest(e);i||(i=l._createTest(e,t),l._storeTest(e,i)),n(new i)})}},h=function(t,n,i){this._test=t,this._expected=n,this._element=i,this._result=!1,this._changed=!0;var o=this;e.subscribe(this._test,"change",function(){o._changed=!0}),this._test.arrange(this._expected,this._element)};h.prototype.succeeds=function(){return this._changed&&(this._changed=!1,this._result=this._test.assert(this._expected,this._element)),this._result};var c={_options:{},_redirects:{},registerModule:function(t,e,n){var i=requirejs.toUrl(t);this._options[i]=e,n&&(this._redirects[n]=t);var o={};o[t]=e,requirejs.config({config:o})},getRedirect:function(t){return this._redirects[t]||t},getModule:function(t){if(!t)throw Error('ModuleRegistry.getModule(path): "path" is a required parameter.');return this._options[t]||this._options[requirejs.toUrl(t)]}},d=function(t,e){this._suitable=!0,"string"==typeof t&&(this._suitable=!1,this._element=e,this._onResultsChangedBind=this._onTestResultsChanged.bind(this),this._count=a.getExpressionsCount(t),this._expression=a.fromString(t),this._loadExpressionTests(this._expression.getConfig()))};d.prototype={getSuitability:function(){return this._suitable},test:function(){var t=this._expression.succeeds();t!=this._suitable&&(this._suitable=t,e.publish(this,"change"))},_loadExpressionTests:function(t){for(var e=0,n=t.length;n>e;e++)Array.isArray(t[e])?this._loadExpressionTests(t[e]):this._loadTesterToExpression(t[e].config,t[e].expression)},_loadTesterToExpression:function(t,n){var i=this;l.getTest(t.path,function(o){n.assignTester(new h(o,t.value,i._element)),e.subscribe(o,"change",i._onResultsChangedBind),i._count--,0===i._count&&i._onReady()})},_onReady:function(){this.test(),e.publish(this,"ready",this._suitable)},_onTestResultsChanged:function(){this.test()}};var p=function(t,n,i){if(!t||!n)throw Error('ModuleController(path,element,options): "path" and "element" are required parameters.');this._path=c.getRedirect(t),this._alias=t,this._element=n,this._options=i||{},this._Module=null,this._module=null,this._conditionsManager=new d(this._options.conditions,this._element),e.subscribe(this._conditionsManager,"ready",this._onInitialized.bind(this)),this._initialized=!this.isModuleConditioned()||this._conditionsManager.getSuitability(),this._available=!1};p.prototype={isModuleAvailable:function(){return this._available=this._conditionsManager.getSuitability(),this._available},isModuleActive:function(){return null!==this._module},isModuleConditioned:function(){return void 0!==this._options.conditions},hasInitialized:function(){return this._initialized},matchesPath:function(t){return this._path===t||this._alias===t},_onInitialized:function(t){this._initialized=!0,e.subscribe(this._conditionsManager,"change",this._onConditionsChange.bind(this)),e.publish(this,"init",this),t&&this._onBecameAvailable()},_onBecameAvailable:function(){this._available=!0,e.publish(this,"available",this)},_onConditionsChange:function(){var t=this._conditionsManager.getSuitability();this._module&&!t&&this.unload(),!this._module&&t&&this._onBecameAvailable()},load:function(){if(this._Module)return this._onLoad(),void 0;var e=this;t([this._path],function(t){e._Module=t,e._onLoad()})},_parseOptionOverrides:function(t){if("string"==typeof t)try{return JSON.parse(t)}catch(e){throw Error('ModuleController.load(): "options" is not a valid JSON string.')}return t},_parseOptions:function(t,e,n){var i,r,s=[],u={},a={};do i=c.getModule(t),s.push({page:i,module:e.options}),t=e.__superUrl;while(e=e.__super);for(r=s.length;r--;)u=o(u,s[r].page),a=o(a,s[r].module);return i=o(a,u),n&&(i=o(i,this._parseOptionOverrides(n))),i},_onLoad:function(){if(this.isModuleAvailable()){var t=this._parseOptions(this._path,this._Module,this._options.options);if("function"==typeof this._Module?this._module=new this._Module(this._element,t):(this._module=this._Module.load?this._Module.load(this._element,t):null,void 0===this._module&&(this._module=this._Module)),!this._module)throw Error('ModuleController.load(): could not initialize module, missing constructor or "load" method.');this._element.setAttribute("data-initialized",this._path),e.inform(this._module,this),e.publish(this,"load",this)}},unload:function(){return this._available=!1,this._module?(e.conceal(this._module,this),this._module.unload&&this._module.unload(),this._element.removeAttribute("data-initialized"),this._module=null,e.publish(this,"unload",this),!0):!1},execute:function(t,e){if(!this._module)return{status:404,response:null};var n=this._module[t];if(!n)throw Error('ModuleController.execute(method,params): function specified in "method" not found on module.');return e=e||[],{status:200,response:n.apply(this._module,e)}}};var f=function(t){if(!t)throw Error('NodeController(element): "element" is a required parameter.');this._element=t,this._element.setAttribute("data-processed","true");var e=this._element.getAttribute("data-priority");this._priority=e?parseInt(e,10):0,this._moduleControllers=[],this._activeModuleController=null,this._activeModuleUnloadBind=this._onActiveModuleUnload.bind(this)};f.hasProcessed=function(t){return"true"===t.getAttribute("data-processed")},f.prototype={load:function(t){if(!t||!t.length)throw Error("NodeController.load(controllers): Expects an array of module controllers as parameters.");this._moduleControllers=t;for(var n,i=0,o=this._moduleControllers.length;o>i;i++)n=this._moduleControllers[i],n.hasInitialized()?this._onModuleInitialized():e.subscribe(n,"init",this._onModuleInitialized.bind(this))},getPriority:function(){return this._priority},getElement:function(){return this._element},matchesSelector:function(t,e){return e&&!n(e,this._element)?!1:i(this._element,t,e)},hasLoadedModule:function(){return this._activeModuleController?this._activeModuleController.isModuleActive():!1},getActiveModuleController:function(){return this._activeModuleController},getModuleController:function(t){return this._getModuleControllers(t,!0)},getModuleControllers:function(t){return this._getModuleControllers(t)},_getModuleControllers:function(t,e){if(void 0===t)return e?this._moduleControllers[0]:this._moduleControllers.concat();for(var n,i=0,o=this._moduleControllers.length,r=[];o>i;i++)if(n=this._moduleControllers[i],n.matchesPath(t)){if(e)return n;r.push(n)}return e?null:r},execute:function(t,e){return this._activeModuleController?this._activeModuleController.execute(t,e):{status:404,response:null}},_onModuleInitialized:function(){for(var t=this._moduleControllers.length;--t>=0;)if(!this._moduleControllers[t].hasInitialized())return;this._onModulesInitialized()},_onModulesInitialized:function(){var t=this._getSuitableActiveModuleController();t&&this._setActiveModuleController(t);for(var n=0,i=this._moduleControllers.length;i>n;n++)e.subscribe(this._moduleControllers[n],"available",this._onModuleAvailable.bind(this))},_onModuleAvailable:function(t){for(var e,n=0,i=this._moduleControllers.length;i>n;n++)if(e=this._moduleControllers[n],e!==t&&e.isModuleAvailable()&&e.isModuleConditioned())return;this._setActiveModuleController(t)},_setActiveModuleController:function(t){t!==this._activeModuleController&&(this._cleanActiveModuleController(),this._activeModuleController=t,e.subscribe(this._activeModuleController,"unload",this._activeModuleUnloadBind),e.inform(this._activeModuleController,this),this._activeModuleController.load())},_cleanActiveModuleController:function(){this._activeModuleController&&(e.unsubscribe(this._activeModuleController,"unload",this._activeModuleUnloadBind),e.conceal(this._activeModuleController,this),this._activeModuleController.unload(),this._activeModuleController=null)},_onActiveModuleUnload:function(){this._cleanActiveModuleController();var t=this._getSuitableActiveModuleController();t&&this._setActiveModuleController(t)},_getSuitableActiveModuleController:function(){for(var t,e=0,n=this._moduleControllers.length;n>e;e++)if(t=this._moduleControllers[e],t.isModuleAvailable())return t;return null}};var _=function(){this._hasLoaded=!1,this._count=arguments.length,this._controllers=[],this._controllerLoadedBind=this._onLoad.bind(this),this._controllerUnloadedBind=this._onUnload.bind(this);for(var t,n=0;this._count>n;n++)t=arguments[n],t.hasLoadedModule&&(e.subscribe(t,"load",this._controllerLoadedBind),e.subscribe(t,"unload",this._controllerUnloadedBind),this._controllers.push(t));this._test()};_.prototype={_onLoad:function(){this._test()},_onUnload:function(){this._unload()},_test:function(){for(var t=0;this._count>t;t++)if(!this._controllers[t].hasLoadedModule())return;this._load()},_load:function(){this._hasLoaded||(this._hasLoaded=!0,e.publishAsync(this,"load",this._controllers))},_unload:function(){this._hasLoaded&&(this._hasLoaded=!1,e.publish(this,"unload",this._controllers))}};var g=function(){this._options={modules:{}},this._nodes=[]};return g.prototype={init:function(t){t&&this.setOptions(t),this.parse(document)},setOptions:function(t){if(!t)throw Error('ModuleLoader.setOptions(options): "options" is a required parameter.');this._options=o(this._options,t);var e,n,i,r;for(n in this._options.modules)this._options.modules.hasOwnProperty(n)&&(i=this._options.modules[n],r="string"==typeof i?i:i.alias,e="string"==typeof i?null:i.options||{},c.registerModule(n,e,r))},parse:function(t){if(!t)throw Error('ModuleLoader.loadModules(context): "context" is a required parameter.');var e,n=t.querySelectorAll("[data-module]"),i=n.length,o=0,r=[];if(!n)return[];for(;i>o;o++)e=n[o],f.hasProcessed(e)||r.push(new f(e));for(r.sort(function(t,e){return t.getPriority()-e.getPriority()}),o=r.length;--o>=0;)r[o].load(this._getModuleControllersByElement(r[o].getElement()));return this._nodes=this._nodes.concat(r),r},load:function(t,e){if(!e)return null;e=e.length?e:[e];var n,i,o=0,r=e.length,s=[];for(n=new f(t);r>o;o++)i=e[o],s.push(new p(i.path,t,{conditions:i.conditions,options:i.options}));return n.load(s),this._nodes.push(n),n},sync:function(){var t=Object.create(_.prototype);return 1!=arguments.length||arguments.slice||(arguments=arguments[0]),_.apply(t,arguments),t},getNode:function(t,e){return this._getNodes(t,e,!0)},getNodes:function(t,e){return this._getNodes(t,e)},_getNodes:function(t,e,n){if(void 0===t&&void 0===e)return n?this._nodes[0]:this._nodes.concat();for(var i,o=0,r=this._nodes.length,s=[];r>o;o++)if(i=this._nodes[o],i.matchesSelector(t,e)){if(n)return i;s.push(i)}return n?null:s},_getModuleControllersByElement:function(t){var e=[],n=t.getAttribute("data-module")||"",i=91===n.charCodeAt(0);if(i){var o;try{o=JSON.parse(n)}catch(r){throw Error('ModuleLoader.load(context): "data-module" attribute contains a malformed JSON string.')}if(!o)return[];for(var s,u=o.length,a=0;u>a;a++)s=o[a],e.push(new p(s.path,t,{conditions:s.conditions,options:s.options}))}else n.length&&e.push(new p(n,t,{conditions:t.getAttribute("data-conditions"),options:t.getAttribute("data-options")}));return e}},new g}),define("conditioner/extendClass",[],function(){return function(){var t,e,n=arguments[arguments.length-1],i=arguments[0];return"string"==typeof i?(t=requirejs,e=i,n.__superUrl=i):(t=i,e=arguments[1],n.__superUrl=t.toUrl(e)),n.__super=t(e),n.prototype=Object.create(n.__super.prototype),n}});