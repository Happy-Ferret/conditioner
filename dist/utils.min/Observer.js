define(function(){"use strict";var a=1,b={};return{_setEntry:function(c,d){var e=c.__pubSubUID;return e||(e=a++,c.__pubSubUID=e,b[e]={obj:c}),b[e][d]||(b[e][d]=[]),b[e]},_getEntryProp:function(a,c){var d=b[a.__pubSubUID];return d?b[a.__pubSubUID][c]:null},subscribe:function(a,b,c){for(var d,e=this._setEntry(a,"subscriptions"),f=0,g=e.subscriptions,h=g.length;h>f;f++)if(d=g[f],d.type===b&&d.fn===c)return;g.push({type:b,fn:c})},unsubscribe:function(a,b,c){var d=this._getEntryProp(a,"subscriptions");if(d)for(var e,f=d.length;--f>=0;)e=d[f],e.type!==b||e.fn!==c&&c||d.splice(f,1)},publishAsync:function(a,b,c){var d=this;setTimeout(function(){d.publish(a,b,c)},0)},publish:function(a,b,c){for(var d,e=this._setEntry(a,"subscriptions"),f=[],g=0,h=e.subscriptions,i=h.length,j=e.receivers;i>g;g++)d=h[g],d.type===b&&f.push(d);for(i=f.length,g=0;i>g;g++)f[g].fn(c);if(j)for(i=j.length,g=0;i>g;g++)this.publish(j[g],b,c)},inform:function(a,b){if(!a||!b)return!1;var c=this._setEntry(a,"receivers");return c.receivers.push(b),!0},conceal:function(a,b){if(!a||!b)return!1;var c=this._getEntryProp(a,"receivers");if(!c)return!1;for(var d,e=c.length;--e>=0;)if(d=c[e],d===b)return c.splice(e,1),!0;return!1}}});