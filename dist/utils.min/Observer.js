define(function(){"use strict";var e=1,t={};return{_setEntry:function(n,i){var r=n.__pubSubUID;return r||(r=e++,n.__pubSubUID=r,t[r]={obj:n}),t[r][i]||(t[r][i]=[]),t[r]},_getEntryProp:function(e,n){var i=t[e.__pubSubUID];return i?t[e.__pubSubUID][n]:null},subscribe:function(e,t,n){for(var i,r=this._setEntry(e,"subscriptions"),s=0,u=r.subscriptions,o=u.length;o>s;s++)if(i=u[s],i.type===t&&i.fn===n)return;u.push({type:t,fn:n})},unsubscribe:function(e,t,n){var i=this._getEntryProp(e,"subscriptions");if(i)for(var r,s=i.length;--s>=0;)r=i[s],r.type!==t||r.fn!==n&&n||i.splice(s,1)},publishAsync:function(e,t,n){var i=this;setTimeout(function(){i.publish(e,t,n)},0)},publish:function(e,t,n){for(var i,r=this._setEntry(e,"subscriptions"),s=[],u=0,o=r.subscriptions,c=o.length,f=r.receivers;c>u;u++)i=o[u],i.type===t&&s.push(i);for(c=s.length,u=0;c>u;u++)s[u].fn(n);if(f)for(c=f.length,u=0;c>u;u++)this.publish(f[u],t,n)},inform:function(e,t){if(!e||!t)return!1;var n=this._setEntry(e,"receivers");return n.receivers.push(t),!0},conceal:function(e,t){if(!e||!t)return!1;var n=this._getEntryProp(e,"receivers");if(!n)return!1;for(var i,r=n.length;--r>=0;)if(i=n[r],i===t)return n.splice(r,1),!0;return!1}}});